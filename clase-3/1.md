```sql

/* 1. CREACIÓN DE LA BASE DE DATOS */
IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = 'BibliotecaDB234')
BEGIN
    CREATE DATABASE BibliotecaDB234;
END;
GO

USE BibliotecaDB234;
GO


/* 2. TABLA: Autores */
CREATE TABLE Autores (
    AutorID INT IDENTITY(1,1) PRIMARY KEY,
    Nombre NVARCHAR(100) NOT NULL,
    Apellido NVARCHAR(100) NOT NULL
);
GO

/* 3. TABLA: Categorias (Géneros) */
CREATE TABLE Categorias (
    CategoriaID INT IDENTITY(1,1) PRIMARY KEY,
    Nombre NVARCHAR(100) NOT NULL UNIQUE
);
GO

/* 4. TABLA: Socios (Miembros) */
CREATE TABLE Socios (
    SocioID INT IDENTITY(1,1) PRIMARY KEY,
    Nombre NVARCHAR(100) NOT NULL,
    Apellido NVARCHAR(100) NOT NULL,
    Email NVARCHAR(255) NOT NULL UNIQUE,
    FechaRegistro DATE NOT NULL DEFAULT GETDATE()
);
GO


/* 5. TABLA: Libros (El "título" o concepto del libro)
 * Depende de Categorias.
 */
CREATE TABLE Libros (
    LibroID INT IDENTITY(1,1) PRIMARY KEY,
    Titulo NVARCHAR(255) NOT NULL,
    ISBN NVARCHAR(13) UNIQUE,
    
    -- Llave Foránea a Categorias
    CategoriaID INT NOT NULL,
    FOREIGN KEY (CategoriaID) REFERENCES Categorias(CategoriaID)
);
GO

/* 6. TABLA: LibroAutor (Tabla de Unión para M-N)
 * Resuelve la relación "Muchos a Muchos" entre Libros y Autores.
 * Un libro puede tener muchos autores.
 * Un autor puede tener muchos libros.
 * 3NF: La PK compuesta (LibroID, AutorID) es la llave. No hay más atributos,
 * por lo que no hay dependencias parciales ni transitivas.
 */
CREATE TABLE LibroAutor (
    LibroID INT NOT NULL,
    AutorID INT NOT NULL,
    
    -- Llave Primaria Compuesta
    PRIMARY KEY (LibroID, AutorID),
    
    -- Llaves Foráneas
    FOREIGN KEY (LibroID) REFERENCES Libros(LibroID),
    FOREIGN KEY (AutorID) REFERENCES Autores(AutorID)
);
GO

/* 7. TABLA: Ejemplares (La copia física del libro)
 * Esta tabla es clave. No prestas el "título" (Libro),
 * prestas la "copia física" (Ejemplar).
 * Depende de Libros.
 */
CREATE TABLE Ejemplares (
    EjemplarID INT IDENTITY(1,1) PRIMARY KEY,
    Localizacion NVARCHAR(50) NULL, -- Ej: 'Estante 3A'
    
    -- Estado: 'Disponible', 'Prestado', 'En Reparacion'
    Estado NVARCHAR(20) NOT NULL DEFAULT 'Disponible'
        CHECK (Estado IN ('Disponible', 'Prestado', 'En Reparacion')),
    
    -- Llave Foránea al título del libro
    LibroID INT NOT NULL,
    FOREIGN KEY (LibroID) REFERENCES Libros(LibroID)
);
GO

/* 8. TABLA: Prestamos (La transacción)
 * Esta es la tabla transaccional principal.
 * Depende de Socios y Ejemplares.
 */
CREATE TABLE Prestamos (
    PrestamoID INT IDENTITY(1,1) PRIMARY KEY,
    FechaPrestamo DATETIME2 NOT NULL DEFAULT GETDATE(),
    FechaDevolucionPrevista DATE NOT NULL,
    FechaDevolucionReal DATE NULL, -- Es NULL hasta que se devuelve
    
    -- Llaves Foráneas
    SocioID INT NOT NULL,
    EjemplarID INT NOT NULL,
    
    FOREIGN KEY (SocioID) REFERENCES Socios(SocioID),
    FOREIGN KEY (EjemplarID) REFERENCES Ejemplares(EjemplarID)
);
GO
```